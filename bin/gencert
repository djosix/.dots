#!/bin/bash

{
    [[ -f RootCA.key ]] || {
        openssl genrsa -des3 -out RootCA.key 2048
        #chmod 600 RootCA.key
    }
    [[ -f RootCA.req ]] || {
        openssl req -new -key RootCA.key -out RootCA.req
    }
    [[ -f RootCA.crt ]] || {
        openssl x509 -req -days 3650 -sha256 -extensions v3_ca -signkey RootCA.key -in RootCA.req -out RootCA.crt
    }
    [[ -f RootCA.srl ]] || {
        echo 1000 > RootCA.srl
    }
    [[ -f RootCA.pem ]] || {
        cat RootCA.crt RootCA.key > RootCA.pem
    }
}

for name in $@; do
    openssl genrsa -out $name.key 2048
    openssl req -new -key $name.key -out $name.req
    openssl x509 -req -days 1095 -sha256 -extensions v3_req -CA RootCA.crt -CAkey RootCA.key -CAserial RootCA.srl -CAcreateserial -in $name.req -out $name.crt
    cat $name.crt $name.key > $name.pem
done
